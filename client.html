<!DOCTYPE html>
<html>
   <head>
                <link rel="stylesheet" type="text/css" href="style.css">
      <script src="/socket.io/socket.io.js"></script>
      <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
                <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/themes/start/jquery-ui.css" type="text/css" rel="Stylesheet" /> 
                <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>          
                <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.5/jquery-ui.min.js"></script>
      <script type ="text/javascript">
      var socketio = io.connect();
      socketio.on("connect", function(){
         socketio.emit("newUser", prompt("Enter the Username:"));
      });
      
      socketio.on("update", function(newInfo) {
                        //update the chatlog with the message or information
         var p = document.getElementById("chatlog").appendChild(document.createElement("p"));
         p.appendChild(document.createTextNode(newInfo));
      });
      
      
      function switchRoom(room){
         socketio.emit('switchRoom', room);
      }

        //a previous 330 student showed me her project, and hers used hrefs, so I tried to emulate that because I thought it was a good idea
      socketio.on("updateRoom", function(rooms, current_room){
         $("#allroom").empty();//clear the list of rooms
        for(var i=0; i<rooms.length; i++){
                if(rooms[i].roomName == current_room){
               $("#allroom").append("<div><b>" + rooms[i].roomName + "</b></div>");
                    }
            else{ 
                $('#allroom').append('<div><a href="#" onclick="switchRoom(\''+rooms[i].roomName+'\')">' + rooms[i].roomName + '</a></div>');
            }
        }
      });
        


      socketio.on("message_to_client",function(username, data) {
         var message = document.getElementById("chatlog").appendChild(document.createElement("p"));
         message.appendChild(document.createTextNode(username+ ": " + data['message']));
      });


      function sendMessage(){
        var msg = document.getElementById("message_input").value;
        socketio.emit("message_to_server", {message:msg});
                $('#message_input').val("");
      }

      function createNewRoom(){
         var roomName = document.getElementById("newRoom").value;
         socketio.emit("addRoom", roomName);
      }

        function pm(){
                var msg = document.getElementById("pm").value;
                var receiver = document.getElementById("receiver").value;
                socketio.emit("pm", receiver, msg);
        }


        socketio.on("pm2", function(username, msg){
        var secretMsg = document.getElementById("chatlog").appendChild(document.createElement("p"));
         secretMsg.appendChild(document.createTextNode("Private Message from" + username + ": " + msg));
                });

                $(function(){
                        // when the client hits ENTER on their keyboard
                        $('#message_input').keypress(function(e) {
                                if(e.which == 13) {
                                        $(this).blur();
                                        $('#msg').focus().click();
                                }
                        });
                });


      </script>
                <title>Chat Room</title>
                <style>
                        body{
                                background:burlywood;
                                text-align: center;
                        }
                </style>
   </head>
   <body>
        <div id="message"> SEND A MESSAGE TO CHAT HERE:
                        <input type="text" id="message_input"/>
                        <button id="msg" onclick="sendMessage()">send</button>
        </div>

                        <h3>Current All Rooms</h3>
                        <div id="allroom"></div>
                        <h3>Create a new room</h3>
                        <input type="text" id="newRoom"/>
                        <button onclick="createNewRoom()">Create</button>
                        <h3>Private Message</h3>
                        Send pm to: <input type="text" id="receiver"/>
                        Message: <input type="text" id="pm"/>
                        <button onclick="pm()">Send Private Message!</button>
                        </br>
------------------------------------------------------------------------------------------------------------------------------



<div id="chatlog"></div>
</body>
</html>
                                                         
